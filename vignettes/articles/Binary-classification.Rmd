---
title: "Binary classification"
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  gganimate = list(nframes = 50)
)

library(ggplot2)

theme_set(theme_minimal(base_size = 21))

if(require(showtext)){
 
  sysfonts::font_add_google("IBM Plex Sans", "plex")
  showtext::showtext_auto()
   
}
```

## Generating data set 

The main function is `sim_response_xy`, you need to define:

- A number of observations to simulate.
- Distributions to sample $x$ and $y$. For example `purrr::partial(runif, min = -1, max = 1)`.
- A gunction  to define the relation between the reponse and the $x$ and $y$, for example
`function(x, y) x > y` This function must return a logical value.
- A number to define the noise in the generated data.

```{r setup}
library(klassets)

set.seed(123)

df <- sim_response_xy(n = 500)

df

plot(df)

df2 <- sim_response_xy(
  n = 1000, 
  x_dist = purrr::partial(runif, min = -1, max = 1),
  relationship = function(x, y)  sqrt(abs(x)) - x - 0.5 > sin(y),
  noise = 0.1
  )

plot(df2)
```


## Apply classification algorithms

### Logistic Regression

```{r}
df_lr <- apply_logistic_regression(df2)

df_lr

plot(df_lr)
```

By defaut the moderl use `order = 1` of the variables, i.e, `response ~ x + y`. We can get a better fit if we increase the order. 

```{r}
df_lr2 <- apply_logistic_regression(df2, order = 5, stepwise = TRUE)

attr(df_lr2, "model")

plot(df_lr2)
```

### Classification Tree `partykit::ctree`

```{r}
df_rt <- apply_classification_tree(df2)

plot(df_rt)
```

The region are filled with the probability of the respective node. We can 
specify the type of the prediction using the `type` argument. In the case of `response`.

```{r}
df_rt_response <- apply_classification_tree(df2, type = "response")

df_rt_response

plot(df_rt_response)
```

And now for the `node`.

```{r}
df_rt_node <- apply_classification_tree(df2, type = "node", maxdepth = 3)

df_rt_node

plot(df_rt_node)

plot(attr(df_rt_node, "model"))
```



