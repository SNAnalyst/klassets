---
title: "Quasi Anscombe data sets"
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(klassets)
library(ggplot2)
library(purrr)
```

## The original set (Type 1)

```{r}
df <- sim_quasianscombe_set_1(beta0 = 10, beta1 = 2, error_sd = 0.1)

plot(df) +
  xlim(0, NA) +
  ylim(0, NA) 
```

## Set 3: Outliers

```{r}
df3_1 <- sim_quasianscombe_set_3(df)
```


## Set 4: Cluster

```{r}
df4_1 <- sim_quasianscombe_set_4(df)

df4_2 <- sim_quasianscombe_set_4(df, rescale_to = c(0, .1), prop = 0.5)
```


## Compare results


```{r}
dfs <- list(
  "Original" = df,
  "Set 3" = df3_1,
  "Set 4 v1" = df4_1,
  "Set 4 v2" = df4_2
)

dfs <- dfs |> 
  tibble::enframe(name = "set") |> 
  tidyr::unnest()

dfs

ggplot(dfs, aes(x, y)) +
  geom_point(shape = 21, fill = "gray80", color = "gray60") +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(vars(set)) + 
  xlim(0, NA) +
  ylim(0, NA) 

df_mods <- dfs |> 
  dplyr::group_nest(set) |> 
  dplyr::mutate(
    model = map(data, lm, formula = y ~ x),
    value = map(model, coefficients),
    coef  = map(value, names)
    ) 

df_mods |> 
  dplyr::select(-data, -model) |> 
  tidyr::unnest(cols = c(value, coef)) |> 
  tidyr::pivot_wider(names_from = coef, values_from = value)
```
